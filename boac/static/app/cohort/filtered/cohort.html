<div class="cohort-container">
  <div data-ng-if="isSaving && !error">
    <h1 class="page-section-header faint-text">Saving....</h1>
  </div>
  <div data-ng-if="error">
    <h1 class="page-section-header">Error</h1>
    <div class="faint-text">
      <span data-ng-bind="error.message" data-ng-if="error.message"></span>
      <span data-ng-if="!error.message">Sorry, there was an error retrieving data.</span>
    </div>
  </div>
  <div class="cohort-label" data-ng-if="!error && !isCreateCohortMode && !isLoading && !isSaving && (cohort.totalStudentCount >= 0)">
    <h1 class="page-section-header" data-ng-if="cohort.name">
      <span data-ng-bind="cohort.name"></span>
      <span class="faint-text">(<span data-ng-pluralize
                                count="cohort.totalStudentCount"
                                when="{'one': '1 student', 'other': '{} students'}"></span>)</span>
    </h1>
    <h1 data-ng-if="!cohort.name">
      <span data-ng-pluralize count="cohort.totalStudentCount" when="{'one': '1 Result', 'other': '{} Results'}"></span>
    </h1>
  </div>
  <div class="cohort-column-results" data-ng-if="!isLoading && !error && !isSaving && isCreateCohortMode">
    <h1 class="page-section-header">Create a Filtered Cohort</h1>
    <div>
      Find a set of users, then save your search as a filtered cohort. Revisit your filtered cohorts at any time.
    </div>
  </div>

  <hr class="filters-section-separator" data-ng-if="!isLoading && !error && !isCreateCohortMode"/>

  <div class="flex-container flex-space-between" data-ng-if="!error">
    <div class="cohort-filters-column flex-column-btn" data-ng-if="isAscUser">
      <filtered-cohort-menu data-menu-type="groupCodes" data-label="Teams"></filtered-cohort-menu>
    </div>
    <div class="cohort-filters-column flex-column-btn">
      <filtered-cohort-menu data-menu-type="levels" data-label="Levels"></filtered-cohort-menu>
    </div>
    <div class="cohort-filters-column flex-column-btn">
      <filtered-cohort-menu data-menu-type="majors" data-label="Majors"></filtered-cohort-menu>
    </div>
    <div class="cohort-filters-column flex-column-btn">
      <filtered-cohort-menu data-menu-type="gpaRanges" data-label="GPA"></filtered-cohort-menu>
    </div>
    <div class="cohort-filters-column flex-column-btn">
      <filtered-cohort-menu data-menu-type="unitRanges" data-label="Units"></filtered-cohort-menu>
    </div>
    <div class="cohort-filters-column cohort-checkbox-column" data-ng-if="!isLoading && !isSaving">
      <div data-ng-if="search.checkboxes.intensive.show">
        <input id="intensive-checkbox"
               type="checkbox"
               data-ng-click="search.checkboxes.intensive.checked = !search.checkboxes.intensive.checked"
               data-ng-checked="search.checkboxes.intensive.checked"/>
        <label class="cohort-checkbox-label"
               for="intensive-checkbox"
               data-ng-bind="search.checkboxes.intensive.label"></label>
      </div>
      <div>
        <input id="inactive-checkbox"
               data-ng-class="{'display-none': !search.checkboxes.inactive.show}"
               type="checkbox"
               data-ng-disabled="!search.checkboxes.inactive.show"
               data-ng-click="search.checkboxes.inactive.checked = !search.checkboxes.inactive.checked"
               data-ng-checked="search.checkboxes.inactive.checked"/>
        <label class="cohort-checkbox-label"
               for="inactive-checkbox"
               data-ng-if="search.checkboxes.inactive.show"
               data-ng-bind="search.checkboxes.inactive.label"></label>
      </div>
      <div data-ng-if="search.checkboxes.advisorLdapUid.show">
        <input id="advisor-ldap-uid-checkbox"
               type="checkbox"
               data-ng-click="search.checkboxes.advisorLdapUid.checked = !search.checkboxes.advisorLdapUid.checked"
               data-ng-checked="search.checkboxes.advisorLdapUid.checked"/>
        <label class="cohort-checkbox-label"
               data-ng-bind="search.checkboxes.advisorLdapUid.label"
               for="advisor-ldap-uid-checkbox"></label>
      </div>
    </div>
    <!-- Apply and save buttons -->
    <div class="cohort-filters-column flex-column-10"></div>
    <div class="cohort-filters-column flex-column-btn">
      <button id="apply-filters-btn"
              class="btn btn-primary no-wrap"
              data-ng-disabled="!enableApplyButton()"
              data-ng-click="applyFilters()">Apply</button>
    </div>
    <div class="cohort-filters-column flex-column-btn">
      <span data-ng-controller="CreateCohortController">
        <button id="create-cohort-btn"
                class="btn btn-default no-wrap"
                data-ng-disabled="!enableApplyButton()"
                data-ng-click="openCreateCohortModal(search)">
          Save Cohort
        </button>
      </span>
    </div>
  </div>

  <hr class="filters-section-separator"
      data-ng-if="!isLoading && !error && !isCreateCohortMode && cohort.totalStudentCount"/>

  <div class="loading-spinner-large" data-ng-if="isLoading && !error">
    <i class="fas fa-sync fa-spin fa-5x"></i>
    <span class="sr-only">Loading...</span>
  </div>

  <div class="cohort-column-results">
    <div class="cohort-tabs-container"
         data-ng-if="!isLoading && !error && (tab === 'matrix' || cohort.totalStudentCount)">

      <div class="cohort-tabs-container-column-01">
        <curated-cohort-selector data-students="cohort.students"
                                 data-ng-if="cohort.students.length && (tab === 'list')"></curated-cohort-selector>
      </div>
      <div class="cohort-tabs-container-column-02">
        <div data-ng-include="'/static/app/shared/tabs.html'"></div>
      </div>
      <div class="cohort-tabs-container-column-03">
        <div class="cohort-sort-column" data-ng-if="tab === 'list'">
          <label class="cohort-sort-label" for="cohort-sort-by">Sort by</label>
          <select id="cohort-sort-by"
                  class="form-control"
                  data-ng-model="orderBy.selected"
                  data-ng-options="o.value as o.name for o in orderBy.options">
          </select>
        </div>
      </div>
    </div>
    <div data-ng-show="tab === 'list'"
         data-ng-if="!isLoading && !error && cohort.totalStudentCount">
      <ul id="cohort-students-list" class="list-group">
        <div class="list-group-item cohort-student-list-item"
             data-ng-class="{'list-group-item-info': anchor===student.uid}"
             data-ng-repeat="student in cohort.students">

          <div class="cohort-list-view-column-00">
            <div class="add-to-cohort-checkbox">
              <input id="student-{{student.uid}}-curated-cohort-checkbox"
                     type="checkbox"
                     data-ng-click="student.curatedCohortToggle($event)"
                     data-ng-model="student.selectedForCuratedCohort"/>
            </div>
          </div>

          <div class="cohort-list-view-column-01">
            <img class="student-avatar student-avatar-large"
                 data-ng-class="{'img-blur': demoMode.blur}"
                 data-ng-src="/api/student/{{student.uid}}/photo"
                 data-avatar-fallback>
          </div>

          <div class="cohort-student-bio-container">
            <div class="cohort-student-name-container">
              <div>
                <a id="{{student.uid}}" data-ng-href="/student/{{student.uid}}">
                  <h3 class="student-name"
                      data-ng-class="{'demo-mode-blur': demoMode.blur}"
                      data-ng-if="orderBy.selected !== 'first_name'">
                    {{student.lastName}}, {{student.firstName}}
                  </h3>
                  <h3 class="student-name"
                      data-ng-class="{'demo-mode-blur': demoMode.blur}"
                      data-ng-if="orderBy.selected === 'first_name'">
                    {{student.firstName}} {{student.lastName}}
                  </h3>
                </a>
              </div>
            </div>
            <div class="student-sid"
                 data-ng-class="{'demo-mode-blur': demoMode.blur}">
              {{student.sid}}
              <span class="red-flag-status"
                    data-ng-if="isAscUser && !student.athleticsProfile.isActiveAsc">INACTIVE</span>
            </div>
            <div class="student-text" data-ng-bind="student.level"></div>
            <div class="student-text" data-ng-bind="major" data-ng-repeat="major in student.majors track by $index"></div>
            <div class="student-teams-container">
              <div class="student-teams"
                   data-ng-bind="team.groupName"
                   data-ng-repeat="team in student.athleticsProfile.athletics"></div>
            </div>
          </div>

          <div class="student-column">
            <div class="student-gpa" data-ng-bind="student.cumulativeGPA || '--'"></div>
            <div class="student-text">GPA (Cumulative)</div>
          </div>

          <div class="student-column">
            <div class="student-gpa" data-ng-bind="student.term.enrolledUnits || '0'"></div>
            <div class="student-text">Units (In Progress)</div>
            <div class="student-gpa" data-ng-bind="student.cumulativeUnits || '--'"></div>
            <div class="student-text">Total Units</div>
          </div>

          <div class="student-course-activity-wrapper">
            <div class="student-course-activity-row">
              <div class="student-column student-text">CLASS</div>
              <div class="student-column student-text">BCOURSES ACTIVITY</div>
              <div class="cohort-list-view-column-grade student-text">MID</div>
              <div class="cohort-list-view-column-grade student-text">FINAL</div>
            </div>
            <div class="student-course-activity-row"
                 data-ng-repeat="enrollment in student.term.enrollments"
                 data-ng-if="student.term.enrollments.length">
              <div class="student-column">
                <div data-ng-bind="enrollment.displayName"></div>
              </div>
              <div class="student-column">
                <div class="cohort-boxplot-container"
                     data-ng-repeat="canvasSite in enrollment.canvasSites"
                     data-ng-if="enrollment.canvasSites.length">
                  <span data-ng-bind="lastActivityDays(canvasSite.analytics)"></span>
                </div>
                <div data-ng-if="!enrollment.canvasSites.length">&mdash;</div>
              </div>
              <div class="cohort-list-view-column-grade">
                <span class="cohort-grade" data-ng-bind="enrollment.midtermGrade" data-ng-if="enrollment.midtermGrade"></span>
                <i class="fas fa-exclamation-triangle boac-exclamation" data-ng-if="isAlertGrade(enrollment.midtermGrade)"></i>
                <span data-ng-if="!enrollment.midtermGrade">&mdash;</span>
              </div>
              <div class="cohort-list-view-column-grade">
                <span class="cohort-grade"
                      data-ng-bind="enrollment.grade"
                      data-ng-if="enrollment.grade"></span>
                <i class="fas fa-exclamation-triangle boac-exclamation" data-ng-if="isAlertGrade(enrollment.grade)"></i>
                <span class="cohort-grading-basis"
                      data-ng-bind="enrollment.gradingBasis"
                      data-ng-if="!enrollment.grade"></span>
                <span data-ng-if="!enrollment.grade && !enrollment.gradingBasis">&mdash;</span>
              </div>
            </div>
            <div class="student-course-activity-row"
                 data-ng-if="!student.term.enrollments.length">
              <div class="student-column faint-text">
                No {{currentEnrollmentTerm.split(' ')[0] | lowercase}} enrollments
              </div>
              <div class="student-column">
                &mdash;
              </div>
              <div class="cohort-list-view-column-grade">
                &mdash;
              </div>
              <div class="cohort-list-view-column-grade">
                &mdash;
              </div>
            </div>
          </div>
        </div>
      </ul>
      <ul uib-pagination
          boundary-link-numbers="true"
          force-ellipses="true"
          max-size="9"
          rotate="false"
          direction-links="false"
          items-per-page="pagination.itemsPerPage"
          total-items="cohort.totalStudentCount"
          ng-model="pagination.currentPage"
          data-ng-click="nextPage()"
          data-ng-if="pagination.enabled && !isCreateCohortMode && (cohort.totalStudentCount > pagination.itemsPerPage)"></ul>
    </div>
    <div id="matrix-outer" data-ng-show="tab === 'matrix' && !isLoading && !error">
      <div data-ng-include="'/static/app/shared/matrix.html'"></div>
    </div>
  </div>
</div>
