<div data-ng-if="filters.isLoading">
  <i class="fas fa-sync fa-spin fa-2x"></i>
</div>
<div data-ng-if="!filters.isLoading">
  <div>
    <div>
      <div class="cohort-filter-row"
           data-ng-repeat="row in filters.added track by $index">
        <div class="cohort-added-filter-name">
          <span data-ng-bind="row.name"></span>
        </div>
        <div class="cohort-added-subcategory-name">
          <span data-ng-bind="row.subcategory.name"
                data-ng-if="row.subcategory && !row.isEditMode"></span>
          <filter-criteria-edit-subcategory filter="row"
                                            on-option-click="row.onOptionClick"
                                            watch="row"
                                            data-ng-if="row.isEditMode"></filter-criteria-edit-subcategory>
          <span class="has-error" data-ng-bind="row.error"></span>
        </div>
        <div class="cohort-added-filter-controls">
          <div class="cohort-added-filter-buttons">
            <div data-ng-if="row.subcategory && allowEdits && !row.isEditMode">
              <button type="button"
                      id="edit-added-filter-{{$index}}"
                      aria-label="Edit added filter"
                      class="btn-link btn-cohort-added-filter"
                      data-ng-click="buttons.editFilter.onClick(row)">
                Edit
              </button> |
            </div>
            <div data-ng-if="!row.isEditMode">
              <button type="button"
                      id="remove-added-filter-{{$index}}"
                      aria-label="Remove added filter"
                      class="btn-link btn-cohort-added-filter"
                      data-ng-click="buttons.removeAddedFilter.onClick($index)">
                Remove
              </button>
            </div>
            <div data-ng-if="row.isEditMode">
              <button type="button"
                      id="update-added-filter-{{$index}}"
                      aria-label="Edit added filter"
                      class="btn btn-primary"
                      data-ng-click="buttons.updateAddedFilter.onClick(row)">
                Update
              </button>
            </div>
            <div data-ng-if="row.isEditMode">
              <button type="button"
                      id="cancel-edit-added-filter-{{$index}}"
                      aria-label="Edit added filter"
                      class="btn-link btn-cohort-added-filter"
                      data-ng-click="buttons.cancelEditFilter.onClick(row)">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="cohort-filter-draft-row" data-ng-if="!filters.isEditMode">
      <div class="cohort-filter-draft-column-01">
        <div class="btn-group"
             uib-dropdown
             keyboard-nav="true"
             is-open="isDraftMenuOpen">
          <button id="draft-filter"
                  type="button"
                  class="btn-filter"
                  data-ng-class="{'btn-filter-open': isDraftMenuOpen}"
                  focus-on="!draft.options"
                  uib-dropdown-toggle
                  ng-disabled="disabled">
            {{draft.name || 'New Filter'}}
            <span data-ng-class="{'fa-angle-up': isDraftMenuOpen, 'fa-angle-down': !isDraftMenuOpen}" class="fas"></span>
          </button>
          <ul class="dropdown-menu cohort-filter-dropdown"
              uib-dropdown-menu
              role="menu"
              aria-labelledby="draft-filter">
            <li role="menuitem"
                data-ng-click="onDraftFilterClick(option)"
                data-ng-class="{'divider': option === null, 'disabled': option.disabled}"
                data-ng-repeat="option in filters.definitions track by $index">
              <a href="#"
                 data-ng-bind="option.name"
                 data-ng-if="option !== null && !option.disabled"></a>
              <span data-ng-bind="option.name"
                    data-ng-class="{'cohort-filter-disabled': option.disabled}"
                    data-ng-if="option !== null && option.disabled"></span>
            </li>
          </ul>
        </div>
      </div>
      <div class="cohort-filter-draft-column-02" data-ng-if="['range', 'array'].indexOf(draft.type) > -1">
        <filter-criteria-edit-subcategory filter="draft"
                                          on-option-click="onDraftSubcategoryOptionClick"
                                          watch="draft"></filter-criteria-edit-subcategory>
      </div>
      <div class="cohort-filter-draft-column-03">
        <div data-ng-if="buttons.addFilter.show">
          <button type="button"
                  id="unsaved-filter-add"
                  aria-label="Add filter to search criteria"
                  class="btn btn-primary"
                  focus-on="buttons.addFilter.show"
                  data-ng-click="buttons.addFilter.onClick()"
                  data-ng-disabled="buttons.addFilter.disabled">
            Add
          </button>
        </div>
      </div>
      <div class="cohort-filter-draft-column-04">
        <div data-ng-if="buttons.cancelDraftFilter.show">
          <button type="button"
                  id="unsaved-filter-reset"
                  aria-label="Cancel new filter selection"
                  class="btn-link cohort-manage-btn-link"
                  data-ng-click="buttons.cancelDraftFilter.onClick()">
            Cancel
          </button>
        </div>
      </div>
    </div>
    <div class="filter-subcategory-error has-error">
      <span data-ng-bind="draft.subcategory.error"></span>
    </div>
  </div>
  <div>
    <div data-ng-if="!filters.isEditMode">
      <button type="button"
              id="unsaved-filter-apply"
              aria-label="Search for students"
              class="btn btn-primary btn-filter-draft-apply"
              data-ng-click="buttons.apply.onClick()"
              data-ng-disabled="buttons.apply.disabled"
              data-ng-if="buttons.apply.show">
        Apply
      </button>
      <span data-ng-controller="CreateFilteredCohortController">
        <button type="button"
                id="unsaved-filter-save-cohort"
                aria-label="Create new cohort"
                class="btn btn-primary btn-filter-draft-save"
                data-ng-click="buttons.saveCohort.onClick(openCreateCohortModal)"
                data-ng-if="buttons.saveCohort.show">
          <span class="fa fa-spinner fa-spin" data-ng-if="isSaving"></span>
          {{isSaving ? 'Saving' : 'Save Cohort'}}
        </button>
      </span>
    </div>
  </div>
</div>
