<div class="container">
  <div data-ng-include="'/static/app/shared/header.html'"></div>

  <div class="loading-spinner-large" data-ng-if="student.isLoading && !error">
    <i class="fa fa-refresh fa-spin fa-5x fa-fw"></i>
    <span class="sr-only">Loading...</span>
  </div>
  <div data-ng-if="!student.isLoading && !error">
    <div class="return-to-cohort" data-ng-if="returnUrl">
      <a data-ng-href="{{returnUrl}}">
        <i class="fa fa-arrow-left" aria-hidden="true"></i> Return to cohort
      </a>
      <div class="container-right">
        Questions or feedback? Contact us at <a href="mailto:ascpilot@lists.berkeley.edu">ascpilot@lists.berkeley.edu</a>
      </div>
    </div>
    <div class="student-profile-header">
      <div class="student-profile-avatar-container">
        <img class="student-profile-avatar"
             data-ng-src="/api/user/{{student.uid}}/photo"
             data-avatar-fallback/>
      </div>
      <div class="student-profile-header-contact">
        <div class="flex-container">
          <h1 class="student-profile-header-name">
            {{student.athleticsProfile.fullName}}
          </h1>
          <watchlist-toggle data-sid="student.athleticsProfile.sid"
                            data-fa-size="fa-2x"
                            data-watchlist="myWatchlist"
                            data-ng-if="!isWatchlistLoading"></watchlist-toggle>
        </div>
        <h3 class="student-profile-header-name-preferred"
            data-ng-bind="student.sisProfile.preferredName"
            data-ng-if="student.sisProfile.preferredName !== student.athleticsProfile.fullName"></h3>
        <a data-ng-href="mailto:{{student.sisProfile.emailAddress}}" data-ng-bind="student.sisProfile.emailAddress"></a>
        <div data-ng-bind="student.sisProfile.phoneNumber"></div>
      </div>
      <div class="student-profile-header-status-box">
        <div class="student-profile-header-status-number" data-ng-bind="student.sisProfile.cumulativeUnits"></div>
        <div class="student-profile-header-status-legend">Total Units</div>
      </div>
      <div class="student-profile-header-status-box">
        <div class="student-profile-header-status-number" data-ng-bind="student.sisProfile.cumulativeGPA || '--'"></div>
        <div class="student-profile-header-status-legend">Cumulative GPA</div>
      </div>
    </div>
    <div class="student-profile-body">
      <div class="student-profile-sidebar">
        <div class="student-profile-sidebar-box">
          <div data-ng-if="!student.athleticsProfile.isActiveAsc">
            <h4 class="student-profile-sidebar-header student-profile-sidebar-inactive">INACTIVE</h4>
          </div>
          <div data-ng-repeat="membership in student.athleticsProfile.athletics">
            <h4 class="student-profile-sidebar-header student-profile-sidebar-header-team" data-ng-bind="membership.groupName"></h4>
          </div>
          <div data-ng-repeat="plan in student.sisProfile.plans">
            <h4 class="student-profile-sidebar-header">
              <span data-ng-bind="plan.description" data-ng-if="!plan.degreeProgramUrl"></span>
              <a data-ng-bind="plan.description" data-ng-if="plan.degreeProgramUrl" data-ng-href="{{plan.degreeProgramUrl}}"></a>
            </h4>
            <div class="student-profile-sidebar-details">
              <div data-ng-bind="plan.program" data-ng-if="plan.program"></div>
            </div>
          </div>
          <h4 class="student-profile-sidebar-header" data-ng-bind="student.sisProfile.level.description"></h4>
          <div class="student-profile-sidebar-details" data-ng-if="student.sisProfile.termsInAttendance">
            <span data-ng-pluralize
                  count="student.sisProfile.termsInAttendance"
                  when="{'one': '1 Term in Attendance', 'other': '{{student.sisProfile.termsInAttendance}} Terms in Attendance'}"></span>
          </div>
        </div>
        <div class="student-profile-sidebar-box" data-ng-if="student.sisProfile.degreeProgress">
          <h4 class="student-profile-sidebar-header">Degree Progress</h4>
          <table class="student-profile-sidebar-table">
            <tr>
              <th>University Requirements</th>
              <th>Status</th>
            </tr>
            <tr data-ng-repeat="requirement in student.sisProfile.degreeProgress.requirements">
              <td data-ng-bind="requirement.name"></td>
              <td>
                <i data-ng-class="{
                        'fa fa-check student-profile-sidebar-icon': requirement.status === 'Satisfied',
                        'fa fa-exclamation-triangle student-profile-sidebar-icon': requirement.status === 'Not Satisfied',
                        'fa fa-clock-o student-profile-sidebar-icon': requirement.status === 'In Progress'
                    }"></i>
                <span data-ng-bind="requirement.status"></span>
              </td>
            </tr>
          </table>
          <div class="student-profile-sidebar-subdetails">
            <div>Degree Progress as of <span data-ng-bind="student.sisProfile.degreeProgress.reportDate"></span>.</div>
            <div>Advisors can refresh this data at <a data-ng-href="{{student.studentProfileLink}}">CalCentral</a>.</div>
          </div>
        </div>
      </div>
      <div class="student-profile-terms">
        <h2>Classes</h2>
        <div class="student-profile-term" data-ng-repeat="term in student.enrollmentTerms | limitTo: (showAllTerms ? undefined : 1)">
          <h3 class="student-profile-classes-header" data-ng-bind="term.termName"></h3>

          <div data-ng-if="$index === 0">
            <div data-ng-if="alerts.shown.length">
              <div class="alert alert-warning student-profile-alert" data-ng-attr-id="alert-{{alert.id}}" data-ng-repeat="alert in alerts.shown">
                <div class="student-profile-alert-item">
                  <student-alert-message alert="alert"></student-alert-message>
                  <a class="close" data-ng-click="dismissAlert(alert.id)" aria-label="close">&times;</a>
                </div>
              </div>
            </div>
            <div data-ng-show="!showDismissedAlerts && alerts.dismissed.length">
              <button class="btn btn-link student-profile-view-previous-semesters" data-ng-click="showDismissedAlerts=true">
                View dismissed status alerts
              </button>
            </div>
            <div data-ng-show="showDismissedAlerts && alerts.dismissed.length">
              <button class="btn btn-link student-profile-view-previous-semesters" data-ng-click="showDismissedAlerts=false">
                Hide dismissed status alerts
              </button>
              <div class="alert alert-warning student-profile-alert">
                <div data-ng-repeat="alert in alerts.dismissed" class="student-profile-alert-item">
                  <student-alert-message alert="alert"></student-alert-message>
                </div>
              </div>
            </div>
          </div>

          <uib-accordion>
            <div uib-accordion-group
                 class="student-profile-class"
                 is-open="status.isFirstOpen"
                 data-ng-repeat="course in term.enrollments">
              <uib-accordion-heading>
                <div class="accordion-heading student-profile-class-heading">
                  <div class="accordion-heading-start">
                    <div class="accordion-heading-start-inner">
                      <div>
                        <i data-ng-class="{'fa fa-caret-right': !status.isFirstOpen, 'fa fa-caret-down': status.isFirstOpen}"></i>
                      </div>
                      <div>
                        <h4 class="student-profile-class-title" data-ng-bind="course.displayName"></h4>
                      </div>
                      <div>
                        <div class="accordion-heading-sections">
                          <div class="faint-text" data-ng-repeat="section in course.sections">
                            <span data-ng-bind="section.component"></span>
                            <span data-ng-bind="section.sectionNumber"></span>
                            <span data-ng-if="!$last">&#47;&nbsp;</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div>
                      <h5 class="student-profile-class-name" data-ng-bind="course.title"></h5>
                    </div>
                  </div>
                  <div class="accordion-heading-end">
                    <div class="accordion-heading-units">
                      <span data-ng-pluralize
                            count="course.units"
                            when="{'one': '1 Unit', 'other': '{{course.units}} Units'}"></span>
                    </div>
                    <div class="accordion-heading-grades">
                      <div class="accordion-heading-grade">
                        Final:
                        <span class="student-profile-class-grade"
                              data-ng-bind="course.grade"
                              data-ng-if="course.grade"></span>
                        <span class="student-profile-class-grading-basis"
                              data-ng-bind="course.gradingBasis"
                              data-ng-if="!course.grade"></span>
                      </div>
                      <div class="accordion-heading-grade">
                        Mid:
                        <span class="student-profile-class-grade"
                              data-ng-bind="course.midtermGrade"
                              data-ng-if="course.midtermGrade"></span>
                        <span class="student-profile-class-grade"
                              data-ng-if="!course.midtermGrade">&mdash;</span>
                      </div>
                    </div>
                  </div>
                </div>
              </uib-accordion-heading>

              <div class="student-profile-class-heading" data-ng-if="course.sections.length">
                <div class="student-profile-class-sections">
                  <div data-ng-repeat="section in course.sections">
                    <span data-ng-if="section.enrollmentStatus === 'W'">Waitlisted in</span>
                    <span data-ng-if="section.enrollmentStatus === 'D'">Dropped</span>
                  </div>
                </div>
              </div>
              <div data-ng-repeat="canvasSite in course.canvasSites">
                <div class="student-profile-course-site-code" data-ng-bind="canvasSite.courseCode"></div>
                <course-site-metrics
                  data-canvas-site="canvasSite"
                  data-course-name="course.displayName"
                  data-draw-boxplot="drawBoxplot"
                  data-term-id="term.termId">
                </course-site-metrics>
              </div>
              <div class="student-profile-class"
                   data-ng-if="term.unmatchedCanvasSites.length">
                <div data-ng-repeat="canvasSite in term.unmatchedCanvasSites" class="student-profile-class">
                  <div class="student-profile-class-heading">
                    <div class="student-profile-class-title-outer">
                      <h4 class="student-profile-class-title" data-ng-bind="canvasSite.courseName"></h4>
                    </div>
                  </div>
                  <course-site-metrics
                    data-canvas-site="canvasSite"
                    data-course-name="'unmatchedCanvasSites'"
                    data-draw-boxplot="drawBoxplot"
                    data-term-id="term.termId">
                  </course-site-metrics>
                </div>
                <div class="student-profile-class" data-ng-if="term.droppedSections.length">
                  <div data-ng-repeat="droppedSection in term.droppedSections" class="student-profile-dropped-section">
                    <div class="student-profile-dropped-section-title">
                      <span data-ng-bind="droppedSection.displayName"></span> -
                      <span data-ng-bind="droppedSection.component"></span>
                      <span data-ng-bind="droppedSection.sectionNumber"></span>
                    </div>
                    <div class="student-profile-class-notation">
                      <i class="fa fa-exclamation-triangle student-profile-dropped-section-icon"></i> Dropped
                    </div>
                  </div>
                </div>
              </div>
              <div class="student-profile-class-notation">
                <i class="fa fa-exclamation-triangle boac-exclamation"></i> Dropped
              </div>
            </div>
          </uib-accordion>
          <!--
          <div data-ng-if="$last">
            Total <span data-ng-bind="term.enrolledUnits"></span>
          </div>
          -->
        </div>

        <div data-ng-show="student.enrollmentTerms.length > 1" class="student-profile-view-previous-semesters-wrapper">
          <button class="btn btn-link student-profile-view-previous-semesters" data-ng-click="showAllTerms=!showAllTerms">
            <i data-ng-class="{'fa fa-caret-right': !showAllTerms, 'fa fa-caret-up': showAllTerms}"></i>
            <span data-ng-if="!showAllTerms">View Previous Semesters</span>
            <span data-ng-if="showAllTerms">Hide Previous Semesters</span>
          </button>
        </div>
        <div class="student-profile-classes" data-ng-if="!student.enrollmentTerms.length">
          No courses
        </div>
      </div>
    </div>
  </div>
  <div class="container-left" data-ng-if="!student.isLoading && error">
    <h1>Error</h1>
    <div data-ng-bind="error"></div>
  </div>

  <div data-ng-include="'/static/app/shared/footer.html'" data-ng-if="!student.isLoading"></div>
</div>
